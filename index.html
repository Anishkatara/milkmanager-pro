<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Anish Dairy â€“ Milk Manager Pro</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<style>
body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    background:#f3f4f6;
}
.login-container{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(135deg,#667eea,#764ba2);
}
.login-box{
    background:#fff;
    width:100%;
    max-width:420px;
    padding:1.6rem;
    border-radius:1rem;
    box-shadow:0 20px 25px rgba(0,0,0,.15);
}
.login-header{
    text-align:center;
    margin-bottom:1.2rem;
}
.login-header img{
    width:140px;
    height:140px;
    border-radius:50%;
    object-fit:cover;
    border:4px solid #1e3a8a;
}
.login-header h1{
    margin:.6rem 0 .2rem;
    color:#1e3a8a;
}
.form-group{margin-bottom:1rem;}
.form-label{font-weight:600;color:#374151;margin-bottom:.3rem;display:block;}
.form-input{
    width:100%;
    padding:.75rem;
    font-size:16px;
    border-radius:.5rem;
    border:2px solid #d1d5db;
}
.form-input:focus{outline:none;border-color:#2563eb;}
.btn{
    width:100%;
    padding:.8rem;
    font-size:1rem;
    border-radius:.5rem;
    border:none;
    cursor:pointer;
    font-weight:600;
}
.btn-primary{background:#2563eb;color:#fff;}
.btn-secondary{background:#e5e7eb;margin-top:.5rem;}
#authMessage{
    display:none;
    margin-top:1rem;
    padding:.7rem;
    border-radius:.5rem;
    font-size:.95rem;
}
.app-container{display:none;}
.app-container.show{display:block;}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login-container" id="loginContainer">
    <div class="login-box">
        <div class="login-header">
            <img src="assets/dairy_logo.png" alt="Milk Manager Logo">
            <h1>Anish Dairy</h1>
            <p style="color:#6b7280;">Milk Manager Pro</p>
        </div>

        <div id="loginForm">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input id="loginEmail" class="form-input" type="email">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input id="loginPassword" class="form-input" type="password">
            </div>
            <button class="btn btn-primary" onclick="handleLogin()">Sign In</button>
            <button class="btn btn-secondary" onclick="toggleAuthMode()">Create Account</button>
        </div>

        <div id="signupForm" style="display:none;">
            <div class="form-group">
                <label class="form-label">Full Name</label>
                <input id="signupName" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input id="signupEmail" class="form-input" type="email">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input id="signupPassword" class="form-input" type="password">
            </div>
            <button class="btn btn-primary" onclick="handleSignup()">Create Account</button>
            <button class="btn btn-secondary" onclick="toggleAuthMode()">Back to Login</button>
        </div>

        <div id="authMessage"></div>
    </div>
</div>

<!-- APP -->
<div class="app-container" id="appContainer">
    <h2 style="padding:1rem;">Welcome to Milk Manager Pro</h2>
    <button class="btn btn-secondary" onclick="handleLogout()" style="width:auto;margin:1rem;">Sign Out</button>
</div>

<script>
/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyA6bK8TZkVqlyeRw-etHi-MxznRW8jBPJQ",
  authDomain: "anish-milk-app.firebaseapp.com",
  databaseURL: "https://anish-milk-app-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "anish-milk-app",
  storageBucket: "anish-milk-app.appspot.com",
  messagingSenderId: "17384087601",
  appId: "1:17384087601:web:83db1f8b77780ffde6b510"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const database = firebase.database();

/* ================= HELPERS ================= */
function showMsg(msg, error=false){
    const el = document.getElementById("authMessage");
    el.style.display="block";
    el.textContent = msg;
    el.style.background = error ? "#fee2e2" : "#dcfce7";
    el.style.color = error ? "#b91c1c" : "#065f46";
    setTimeout(()=>el.style.display="none",3000);
}

/* ================= AUTH UI ================= */
function toggleAuthMode(){
    const login=document.getElementById("loginForm");
    const signup=document.getElementById("signupForm");
    login.style.display = login.style.display==="none" ? "block" : "none";
    signup.style.display = signup.style.display==="none" ? "block" : "none";
}

/* ================= LOGIN ================= */
async function handleLogin(){
    const email=loginEmail.value.trim();
    const pass=loginPassword.value;
    if(!email||!pass){showMsg("Fill all fields",true);return;}
    try{
        await auth.signInWithEmailAndPassword(email,pass);
        showMsg("Login successful");
    }catch(e){
        showMsg(e.message,true);
    }
}

/* ================= SIGNUP ================= */
async function handleSignup(){
    const name=signupName.value.trim();
    const email=signupEmail.value.trim();
    const pass=signupPassword.value;
    if(!name||!email||pass.length<6){
        showMsg("Invalid signup data",true);return;
    }
    try{
        const cred=await auth.createUserWithEmailAndPassword(email,pass);
        await database.ref("users/"+cred.user.uid+"/profile").set({name,email});
        showMsg("Account created");
    }catch(e){
        showMsg(e.message,true);
    }
}

/* ================= LOGOUT ================= */
function handleLogout(){
    auth.signOut();
}

/* ================= AUTH STATE ================= */
auth.onAuthStateChanged(user=>{
    if(user){
        loginContainer.style.display="none";
        appContainer.classList.add("show");
    }else{
        loginContainer.style.display="flex";
        appContainer.classList.remove("show");
    }
});
</script>

</body>
</html>
